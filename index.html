<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Carbon Emission Detector</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f4f6f8;
            text-align: center;
            padding: 20px;
        }

        video {
            width: 320px;
            border-radius: 10px;
            border: 2px solid #2ecc71;
        }

        button {
            margin-top: 12px;
            padding: 12px 28px;
            font-size: 16px;
            border: none;
            border-radius: 6px;
            background: #2ecc71;
            color: white;
            cursor: pointer;
        }

        button:disabled {
            background: gray;
        }

        #result {
            margin-top: 20px;
            background: white;
            padding: 15px;
            border-radius: 10px;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .item {
            background: #ecf0f1;
            margin: 6px 0;
            padding: 8px;
            border-radius: 6px;
        }
    </style>
</head>

<body>

    <h2>Carbon Emission Detector</h2>
    <p>Point camera at an object → Click Analyze</p>

    <video id="video" autoplay playsinline></video><br>
    <button id="scanBtn">Capture & Analyze</button>

    <canvas id="canvas" width="320" height="240" style="display:none;"></canvas>

    <div id="result">Waiting...</div>

    <script>
        /* ================= CONFIG ================= */

        const API_KEY = "PUT_YOUR_ROBOFLOW_API_KEY_HERE";
        const MODEL_ID = "coco/1280";
        const MODEL_URL = `https://detect.roboflow.com/${MODEL_ID}?api_key=${API_KEY}`;

        const video = document.getElementById("video");
        const canvas = document.getElementById("canvas");
        const result = document.getElementById("result");
        const scanBtn = document.getElementById("scanBtn");

        /* ============ MATERIAL MAP ============ */
        const materialMap = {
            "bottle": "plastic", "cup": "plastic", "fork": "plastic", "knife": "plastic",
            "spoon": "plastic", "toothbrush": "plastic", "remote": "plastic", "mouse": "plastic",
            "keyboard": "plastic", "bag": "plastic",

            "cell phone": "electronic", "laptop": "electronic", "tv": "electronic", "monitor": "electronic",

            "book": "paper", "newspaper": "paper", "cardboard": "paper", "box": "paper",

            "wine glass": "glass", "vase": "glass", "glass": "glass",

            "chair": "wood", "table": "wood", "bed": "wood",

            "banana": "organic", "apple": "organic", "orange": "organic"
        };

        /* ============ EMISSION VALUES (kg CO2/item) ============ */
        const emissionValues = {
            plastic: 6.0,
            metal: 8.0,
            paper: 1.3,
            glass: 1.8,
            wood: 0.5,
            electronic: 12.0,
            organic: 0.2,
            unknown: 0.0
        };

        /* ============ CAMERA START ============ */
        navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } })
            .then(stream => video.srcObject = stream)
            .catch(err => {
                result.innerHTML = "Camera access denied";
                scanBtn.disabled = true;
            });

        /* ============ CAPTURE & ANALYZE ============ */
        async function analyze() {
            scanBtn.disabled = true;
            result.innerHTML = "Analyzing...";

            try {
                const ctx = canvas.getContext("2d");
                ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

                const imageData = canvas.toDataURL("image/jpeg");

                const response = await fetch(MODEL_URL, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/x-www-form-urlencoded"
                    },
                    body: imageData
                });

                if (!response.ok) {
                    throw new Error("HTTP " + response.status);
                }

                const data = await response.json();

                if (!data.predictions || data.predictions.length === 0) {
                    result.innerHTML = "No objects detected.";
                    scanBtn.disabled = false;
                    return;
                }

                let total = 0;
                let html = "<h3>Detected Objects</h3>";

                data.predictions
                    .filter(p => p.confidence >= 0.2)
                    .forEach(p => {
                        const label = p.class.toLowerCase();
                        const material = materialMap[label] || "unknown";
                        const emission = emissionValues[material] || 0;

                        total += emission;

                        html += `
                    <div class="item">
                        <b>${p.class}</b> (${(p.confidence * 100).toFixed(1)}%)<br>
                        Material: ${material}<br>
                        Emission: ${emission} kg CO₂
                    </div>
                `;
                    });

                html += `<h3>Total Estimated Emission: ${total.toFixed(2)} kg CO₂</h3>`;
                html += `<small>(Approximate educational estimate)</small>`;

                result.innerHTML = html;

            } catch (err) {
                result.innerHTML = "AI analysis failed: " + err.message;
                console.error(err);
            }

            scanBtn.disabled = false;
        }

        scanBtn.onclick = analyze;
    </script>

</body>

</html>